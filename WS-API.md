# WebSocket API - Specification
----
## Формат данных
Все взаимодействия между /back и /front, в дальнейшем именуемые events, имеют следующий формат
```json
{
  "id": 1234123412341,
  "type_id": 1,
  "payload": {...}
}
```
### Аттрибуты
* **id** - Уникальный в пределах системы числовой идентификатор события.
* **[type_id](WS-API.md#%D0%A2%D0%B8%D0%BF%D1%8B-%D0%BF%D0%B5%D1%80%D0%B5%D1%81%D1%8B%D0%BB%D0%B0%D0%B5%D0%BC%D1%8B%D1%85-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85)** - Идентификатор типа данных в payload
* **payload** - передаваемый объект

> Сообщения от сервера к клиенту и от клиента к серверу пересылаться массивами
>```json
>[{
>  "id": 1234,
>  "type_id": 1,
>  "payload": {...}
>  },
>  {
>  "id": 1234,
>  "type_id": 1,
>  "payload": {...}
>  }, 
>  ...
>]

> В случае когда формирование сообщения происходит на клиенте - поле "id" может отсутствовать, в любом случае его значение не учитывается.

> В случае отсылки клиентом сообщения, в ответе приходит код выполнения операции и уникальный идентификатор сообщения, в случае если отсылка выполнена успешно.
>```json
>{
>"error": {
>   "code": 11
>   "text": "Текст ошибки"
>   }
>"id": 1234123
>}
```
### Аттрибуты
* **id** - Уникальный в пределах системы числовой идентификатор события.
* **error** - Результат операции
  * **code** - Код ошибки или 0
  * **text** - Текст ошибки либо "" при code=0

> В дальнейшем, сообщения о доставке, прочтении и т.п. приходят в связке с переданным идентификатором сообщения **id**

## Типы пересылаемых данных

|     type_id    |   Описание  |
|:--------------:|:-----------:|
| `1` | Карточка "Новость" |
| `2` | Карточка "Статья" |
| `3` | Карточка "[Рекламный блок](WS-API.md#3-%D0%A0%D0%B5%D0%BA%D0%BB%D0%B0%D0%BC%D0%BD%D1%8B%D0%B9-%D0%B1%D0%BB%D0%BE%D0%BA)" |
| `4` | Карточка "Викторина" |
| `5` | Карточка "Партнерский контент" |
| `6` | Карточка "Место" |
| `7` | Карточка "Мероприятие" |
| `8` | Карточка "Матч" |
| `9` | Карточка "Розыгрыш" |
| `10` | Карточка "Купоны и скидки" |
|      |  |
| `101` | [Текстовое сообщение](WS-API.md#101-%D0%A2%D0%B5%D0%BA%D1%81%D1%82%D0%BE%D0%B2%D0%BE%D0%B5-%D1%81%D0%BE%D0%BE%D0%B1%D1%89%D0%B5%D0%BD%D0%B8%D0%B5) |
| `102` | [Картинка](WS-API.md#102-%D0%9A%D0%B0%D1%80%D1%82%D0%B8%D0%BD%D0%BA%D0%B0) |
| `103` | [HTML](WS-API.md#103-html) |
| `104` | Координаты |
| `105` | [Видео](WS-API.md#105-%D0%92%D0%B8%D0%B4%D0%B5%D0%BE) |
| `106` | Стикер |
| `107` | Контакты профиля |
| `201` | [Сообщение доставлено](WS-API.md#201-%D0%A1%D0%BE%D0%BE%D0%B1%D1%89%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BE%D1%81%D1%82%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%BE) |
| `202` | [Сообщение прочитано](WS-API.md#202-%D0%A1%D0%BE%D0%BE%D0%B1%D1%89%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BF%D1%80%D0%BE%D1%87%D0%B8%D1%82%D0%B0%D0%BD%D0%BE) |

## Формат передаваемых данных (payload)
### `3` Рекламный блок
```json
{
"time": 24545455252,
"type_id": 3,
"sender_id": 1876876,
"chat_id": 123,
"is_forward": true,
"data": {
  "id": 25060,
  "photo_url": "http://cdn.fanlive2018.ru/445445/4534/photo.jpg",
  "text": "МакЭксперс, кофе с собой, опбалат картой, круглосуточная жрачка..."
  }
}
```
#### Аттрибуты
* **time** - время создания сообщения в Unix Timestamp
* **[type_id](WS-API.md#%D0%A2%D0%B8%D0%BF%D1%8B-%D0%BF%D0%B5%D1%80%D0%B5%D1%81%D1%8B%D0%BB%D0%B0%D0%B5%D0%BC%D1%8B%D1%85-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85)** - Идентификатор типа данных
* **sender_id** - Уникальный идентификатор отправителя
* **chat_id** - Уникальный идентификатор чата
* **is_forward** - флаг определяющий что данные являются переслаными.
* **data** - Полезные данные
  * **id** - Идентификатор карточки рекламного блока
  * **photo_url** - URL рекламного баннера
  * **text** - Текст рекламного баннера
> Для сообщений передающих данные типа карточка, **is_forward** всегда **true**

> При передаче серверу репоста "карточка", формат пересылаемых данных следующий
>```json
>{
>"time": 24545455252,
>"type_id": 3,
>"sender_id": 1876876,
>"chat_id": 123,
>"is_forward": true,
>"data": {
>   "id": 25060,
>   }
>}
>```

### `101` Текстовое сообщение
```json
{
"time": 24545455252,
"type_id": 101,
"sender_id": 1876876,
"chat_id": 123,
"is_forward": false,
"data": {
  "message": "Здравствуй Петя!",
  }
}
```
#### Аттрибуты
* **time** - время создания сообщения в Unix Timestamp
* **[type_id](WS-API.md#%D0%A2%D0%B8%D0%BF%D1%8B-%D0%BF%D0%B5%D1%80%D0%B5%D1%81%D1%8B%D0%BB%D0%B0%D0%B5%D0%BC%D1%8B%D1%85-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85)** - Идентификатор типа данных
* **sender_id** - Уникальный идентификатор отправителя
* **chat_id** - Уникальный идентификатор чата
* **is_forward** - флаг определяющий что данные являются переслаными
* **data** - Полезные данные 
   * **message** - Текстовое сообщение
> В случае когда **is_forward** = **true** поле **data** содержит payload пересылаемого сообщения
>```json
>{
>"time": 24545455252,
>"type_id": 101,
>"sender_id": 1876876,
>"chat_id": 123,
>"is_forward": true,
>"data": {
>   "time": 44545455252,
>   "type_id": 101,
>   "sender_id": 11876876,
>   "chat_id": 123,
>   "is_forward": false,
>   "data": {
>     "message": "Здравствуй Петя!",
>     }
>   }
>}
>```



### `102` Картинка
```json
{
"time": 24545455252,
"type_id": 102,
"sender_id": 1876876,
"chat_id": 123,
"is_forward": false,
"data": {
  "image": "https://cdn.fanlive2018.ru/445445/4534/photo3.jpg",
  "text": "текстовые данные",
  }
}
```
#### Аттрибуты
* **time** - время создания сообщения в Unix Timestamp
* **[type_id](WS-API.md#%D0%A2%D0%B8%D0%BF%D1%8B-%D0%BF%D0%B5%D1%80%D0%B5%D1%81%D1%8B%D0%BB%D0%B0%D0%B5%D0%BC%D1%8B%D1%85-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85)** - Идентификатор типа данных
* **sender_id** - Уникальный идентификатор отправителя
* **chat_id** - Уникальный идентификатор чата
* **is_forward** - флаг определяющий что данные являются переслаными
* **data** - Полезные данные 
   * **image** - URL картинки
   * **text** - Текстовая подпись для картинки
> В случае когда **is_forward** = **true** поле **data** содержит payload пересылаемого сообщения

### `103` HTML
```json
{
"time": 24545455252,
"type_id": 103,
"sender_id": 1876876,
"chat_id": 123,
"is_forward": false,
"data": {
  "html": " <!DOCTYPE html><html><body><h1>My First Heading</h1><p>My first paragraph.</p></body></html> ",
  }
}
```
#### Аттрибуты
* **time** - время создания сообщения в Unix Timestamp
* **[type_id](WS-API.md#%D0%A2%D0%B8%D0%BF%D1%8B-%D0%BF%D0%B5%D1%80%D0%B5%D1%81%D1%8B%D0%BB%D0%B0%D0%B5%D0%BC%D1%8B%D1%85-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85)** - Идентификатор типа данных
* **sender_id** - Уникальный идентификатор отправителя
* **chat_id** - Уникальный идентификатор чата
* **is_forward** - флаг определяющий что данные являются переслаными
* **data** - Полезные данные 
   * **html** - HTML 
> В случае когда **is_forward** = **true** поле **data** содержит payload пересылаемого сообщения

### `105` Видео
```json
{
"time": 24545455252,
"type_id": 105,
"sender_id": 1876876,
"chat_id": 123,
"is_forward": false,
"data": {
  "video": "https://cdn.fanlive2018.ru/445445/4534/video.mp4",
  "text": "текстовые данные",
  }
}
```
#### Аттрибуты
* **time** - время создания сообщения в Unix Timestamp
* **[type_id](WS-API.md#%D0%A2%D0%B8%D0%BF%D1%8B-%D0%BF%D0%B5%D1%80%D0%B5%D1%81%D1%8B%D0%BB%D0%B0%D0%B5%D0%BC%D1%8B%D1%85-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85)** - Идентификатор типа данных
* **sender_id** - Уникальный идентификатор отправителя
* **chat_id** - Уникальный идентификатор чата
* **is_forward** - флаг определяющий что данные являются переслаными
* **data** - Полезные данные 
   * **video** - URL видео
   * **text** - Текстовая подпись для картинки
> В случае когда **is_forward** = **true** поле **data** содержит payload пересылаемого сообщения

### `201` Сообщение доставлено
```json
{
"time": 24545455252,
"type_id": 201,
"sender_id": 1876876,
"chat_id": 123,
"is_forward": false,
"data": {
  "id": 123132,
  }
}
```
#### Аттрибуты
* **time** - время создания сообщения в Unix Timestamp
* **[type_id](WS-API.md#%D0%A2%D0%B8%D0%BF%D1%8B-%D0%BF%D0%B5%D1%80%D0%B5%D1%81%D1%8B%D0%BB%D0%B0%D0%B5%D0%BC%D1%8B%D1%85-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85)** - Идентификатор типа данных
* **sender_id** - Уникальный идентификатор отправителя
* **chat_id** - Уникальный идентификатор чата
* **is_forward** - В данном случае всегда false
* **data** - Полезные данные 
   * **id** - Уникальный идентификатор сообщения
> Присылается в случае когда сообщение доставлено хотя-бы одному получателю

### `202` Сообщение прочитано
```json
{
"time": 24545455252,
"type_id": 202,
"sender_id": 1876876,
"chat_id": 123,
"is_forward": false,
"data": {
  "id": 123132,
  }
}
```
#### Аттрибуты
* **time** - время создания сообщения в Unix Timestamp
* **[type_id](WS-API.md#%D0%A2%D0%B8%D0%BF%D1%8B-%D0%BF%D0%B5%D1%80%D0%B5%D1%81%D1%8B%D0%BB%D0%B0%D0%B5%D0%BC%D1%8B%D1%85-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85)** - Идентификатор типа данных
* **sender_id** - Уникальный идентификатор отправителя
* **chat_id** - Уникальный идентификатор чата
* **is_forward** - В данном случае всегда false
* **data** - Полезные данные 
   * **id** - Уникальный идентификатор сообщения
> Присылается в случае когда сообщение прочитано хотя-бы одним получателем

